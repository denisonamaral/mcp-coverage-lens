# Coverage Lens

An MCP (Model Context Protocol) server that reads test coverage reports and provides coverage data to AI assistants like Claude.

## How It Works

1. The server reads Clover XML coverage reports using stream parsing for greater efficiency
2. Retrieving only data about the specified file, without loading the entire coverage report into the context window.
3. When you ask about a specific file's coverage, it extracts and returns the relevant `<file>` tag
4. The AI assistant can then interpret the coverage data (line hits, branch coverage, etc.)

## Features

- Reads Clover XML coverage reports (commonly generated by Istanbul/nyc, PHPUnit, and other testing tools)
- Provides file-specific coverage data on demand
- Integrates seamlessly with MCP-compatible AI clients
- Lightweight and fast with streaming XML parsing

## Installation

```bash
# Clone the repository
git clone https://github.com/denisonamaral/mcp-coverage-lens.git
cd mcp-coverage-lens

# Install dependencies
npm install

# Build the project
npm run build
```

## Configuration

### Environment Variables

| Variable                    | Description                                  | Default                 |
| --------------------------- | -------------------------------------------- | ----------------------- |
| `COVERAGE_REPORT_FILE_PATH` | Optional custom path to your clover.xml file | `./coverage/clover.xml` |

### Claude Desktop Configuration

Add the following to your configuration file:

```json
{
  "mcpServers": {
    "coverage-lens": {
      "command": "node",
      "args": ["/absolute/path/to/mcp-coverage-lens/build/index.js"],
      "env": {
        "COVERAGE_REPORT_FILE_PATH": "/path/to/your/project/coverage/clover.xml" //Optional
      }
    }
  }
}
```

## Available Tools

### get_file_coverage

Returns coverage data for a specific file from the test report.

**Parameters:**

- `targetFile` (string, required): File name to get coverage for

**Example usage in Claude:**

```
What is the test coverage for the file "UserService.ts"?

or without extension file

What is the test coverage for the file "UserController"?
```

## Generating Coverage Reports

Coverage Lens reads Clover XML format. Here's how to generate compatible reports:

### JavaScript/TypeScript (Jest)

```json
// package.json
{
  "scripts": {
    "test:coverage": "jest --coverage"
  }
}
```

## Development

```bash
# Install dependencies
npm install

# Build the project
npm run build

# The compiled output will be in the build/ directory
```

### Project Structure

```
mcp-coverage-lens/
├── src/
│   └── index.ts      # Main MCP server implementation
├── build/            # Compiled JavaScript output
├── package.json
├── tsconfig.json
└── README.md
```

### Tech Stack

- TypeScript (ES2022)
- [MCP SDK](https://github.com/modelcontextprotocol/typescript-sdk) for server implementation
- Zod for input validation

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

MIT License - see [LICENSE](LICENSE) for details.
